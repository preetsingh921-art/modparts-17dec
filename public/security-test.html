<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Security Test - Bot Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .test-button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #005a87;
        }
        .test-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 3px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        #summary {
            margin-top: 30px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 5px;
        }
        .hidden-field {
            position: absolute;
            left: -9999px;
            width: 1px;
            height: 1px;
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Security Test Suite</h1>
        <p>This page simulates various bot behaviors to test your website's security measures.</p>
        
        <div class="test-section">
            <h3>üöÄ Test 1: Speed Bot Attack</h3>
            <p>Simulates a bot that submits forms extremely quickly (under 1 second)</p>
            <button class="test-button" onclick="testSpeedBot()">Run Speed Bot Test</button>
            <div id="speed-result"></div>
        </div>

        <div class="test-section">
            <h3>üçØ Test 2: Honeypot Bot Attack</h3>
            <p>Simulates a bot that fills hidden honeypot fields</p>
            <button class="test-button" onclick="testHoneypotBot()">Run Honeypot Test</button>
            <div id="honeypot-result"></div>
        </div>

        <div class="test-section">
            <h3>üî• Test 3: Rate Limiting Test</h3>
            <p>Sends multiple rapid requests to test rate limiting</p>
            <button class="test-button" onclick="testRateLimiting()">Run Rate Limit Test</button>
            <div id="ratelimit-result"></div>
        </div>

        <div class="test-section">
            <h3>üë§ Test 4: Legitimate User Test</h3>
            <p>Simulates normal human behavior (should work)</p>
            <button class="test-button" onclick="testLegitimateUser()">Run Legitimate User Test</button>
            <div id="legitimate-result"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Test All</h3>
            <button class="test-button" onclick="runAllTests()" style="background: #28a745;">Run All Security Tests</button>
            <button class="test-button" onclick="clearResults()" style="background: #6c757d;">Clear Results</button>
        </div>

        <div id="summary"></div>

        <!-- Hidden honeypot field for testing -->
        <input type="text" name="website" class="hidden-field" id="honeypot-field">
    </div>

    <script>
        let testResults = [];

        // API endpoint
        const API_BASE = '/api';

        // Utility function to make API calls
        async function makeAPICall(endpoint, data, options = {}) {
            const startTime = performance.now();
            
            try {
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'User-Agent': options.userAgent || 'SecurityTestBot/1.0',
                        ...options.headers
                    },
                    body: JSON.stringify(data)
                });

                const responseData = await response.json();
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);

                return {
                    success: response.ok,
                    status: response.status,
                    data: responseData,
                    duration: duration
                };
            } catch (error) {
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                return {
                    success: false,
                    status: 0,
                    error: error.message,
                    duration: duration
                };
            }
        }

        // Display result in UI
        function displayResult(elementId, result, testName) {
            const element = document.getElementById(elementId);
            const isBlocked = !result.success && (result.status === 400 || result.status === 429);
            const isSuccess = result.success;
            
            let className, message;
            
            if (testName === 'Legitimate User' && !isBlocked) {
                className = 'success';
                message = `‚úÖ PASS: Legitimate user was not blocked (${result.duration}ms)`;
            } else if (testName !== 'Legitimate User' && isBlocked) {
                className = 'success';
                message = `‚úÖ PASS: ${testName} was blocked! (${result.duration}ms)`;
            } else if (testName !== 'Legitimate User' && !isBlocked) {
                className = 'warning';
                message = `‚ö†Ô∏è FAIL: ${testName} was NOT blocked (${result.duration}ms)`;
            } else {
                className = 'error';
                message = `‚ùå FAIL: Legitimate user was blocked (${result.duration}ms)`;
            }
            
            message += `<br>Status: ${result.status}, Response: ${result.data?.message || result.error || 'No message'}`;
            
            element.innerHTML = `<div class="result ${className}">${message}</div>`;
            
            return testName !== 'Legitimate User' ? isBlocked : !isBlocked;
        }

        // Test 1: Speed Bot
        async function testSpeedBot() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Testing...';
            
            // Submit immediately (no delay)
            const result = await makeAPICall('/auth/login', {
                email: 'speedbot@test.com',
                password: 'password123'
            }, {
                userAgent: 'SpeedBot/1.0 (Ultra Fast)'
            });
            
            const passed = displayResult('speed-result', result, 'Speed Bot');
            testResults[0] = passed;
            
            button.disabled = false;
            button.textContent = 'Run Speed Bot Test';
            updateSummary();
        }

        // Test 2: Honeypot Bot
        async function testHoneypotBot() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Testing...';
            
            // Wait a bit then submit with honeypot field filled
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const result = await makeAPICall('/auth/login', {
                email: 'honeypotbot@test.com',
                password: 'password123',
                website: 'http://spam-site.com' // Honeypot field
            }, {
                userAgent: 'HoneypotBot/1.0 (Form Filler)'
            });
            
            const passed = displayResult('honeypot-result', result, 'Honeypot Bot');
            testResults[1] = passed;
            
            button.disabled = false;
            button.textContent = 'Run Honeypot Test';
            updateSummary();
        }

        // Test 3: Rate Limiting
        async function testRateLimiting() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Testing...';
            
            const promises = [];
            
            // Send 6 requests rapidly
            for (let i = 0; i < 6; i++) {
                promises.push(makeAPICall('/auth/login', {
                    email: `ratetest${i}@test.com`,
                    password: 'wrongpassword'
                }, {
                    userAgent: `RateLimitBot/1.0 (Request ${i + 1})`
                }));
            }
            
            const results = await Promise.all(promises);
            const blockedCount = results.filter(r => r.status === 429).length;
            
            const element = document.getElementById('ratelimit-result');
            let className, message;
            
            if (blockedCount > 0) {
                className = 'success';
                message = `‚úÖ PASS: Rate limiting is working! ${blockedCount}/6 requests were blocked`;
                testResults[2] = true;
            } else {
                className = 'warning';
                message = `‚ö†Ô∏è FAIL: Rate limiting may not be active. 0/6 requests were blocked`;
                testResults[2] = false;
            }
            
            element.innerHTML = `<div class="result ${className}">${message}</div>`;
            
            button.disabled = false;
            button.textContent = 'Run Rate Limit Test';
            updateSummary();
        }

        // Test 4: Legitimate User
        async function testLegitimateUser() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Testing...';
            
            // Wait 3 seconds to simulate human timing
            await new Promise(resolve => setTimeout(resolve, 3000));
            
            const result = await makeAPICall('/auth/login', {
                email: 'legitimate@user.com',
                password: 'password123'
                // No honeypot field
            }, {
                userAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
            });
            
            const passed = displayResult('legitimate-result', result, 'Legitimate User');
            testResults[3] = passed;
            
            button.disabled = false;
            button.textContent = 'Run Legitimate User Test';
            updateSummary();
        }

        // Run all tests
        async function runAllTests() {
            const button = event.target;
            button.disabled = true;
            button.textContent = 'Running All Tests...';
            
            await testSpeedBot();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testHoneypotBot();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testRateLimiting();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testLegitimateUser();
            
            button.disabled = false;
            button.textContent = 'Run All Security Tests';
        }

        // Clear all results
        function clearResults() {
            document.getElementById('speed-result').innerHTML = '';
            document.getElementById('honeypot-result').innerHTML = '';
            document.getElementById('ratelimit-result').innerHTML = '';
            document.getElementById('legitimate-result').innerHTML = '';
            document.getElementById('summary').innerHTML = '';
            testResults = [];
        }

        // Update summary
        function updateSummary() {
            const validResults = testResults.filter(r => r !== undefined);
            if (validResults.length === 0) return;
            
            const passedTests = validResults.filter(r => r === true).length;
            const totalTests = validResults.length;
            const score = Math.round((passedTests / totalTests) * 100);
            
            let summaryClass, summaryMessage;
            
            if (score >= 75) {
                summaryClass = 'success';
                summaryMessage = 'üéâ EXCELLENT: Your security is working very well!';
            } else if (score >= 50) {
                summaryClass = 'warning';
                summaryMessage = '‚ö†Ô∏è GOOD: Security is working but could be improved';
            } else {
                summaryClass = 'error';
                summaryMessage = 'üö® POOR: Security needs immediate attention';
            }
            
            document.getElementById('summary').innerHTML = `
                <h3>üìä Security Test Summary</h3>
                <div class="result ${summaryClass}">
                    <strong>Score: ${passedTests}/${totalTests} tests passed (${score}%)</strong><br>
                    ${summaryMessage}
                </div>
            `;
        }
    </script>
</body>
</html>
